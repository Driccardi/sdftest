# 070.030 - Customer Segmentation

**Process Area**: Market-to-ROI
**Configuration ID**: 070.030
**Priority**: Medium
**Estimated Effort**: 8 hours
**Dependencies**: 030.010 (Customer Categories), 4010.010 (Custom Customer Fields), 070.010 (Campaign Management)

---

## Overview

Configure dynamic customer segmentation to enable targeted marketing campaigns, personalized offers, and retention programs. Implement RFM (Recency, Frequency, Monetary) analysis and automated segment assignment based on purchase behavior, engagement, and customer lifecycle stage.

### Business Objectives
- Identify high-value customers for VIP treatment
- Detect at-risk customers for retention campaigns
- Target new customers with onboarding offers
- Win back lapsed customers with re-engagement campaigns
- Personalize marketing messages based on customer behavior
- Optimize marketing spend by focusing on high-potential segments

### Stakeholders
- **Primary**: Marketing Team, CRM Manager
- **Secondary**: Store Managers (VIP customer identification), Customer Service (personalized support)

---

## Customer Segment Types

### 1. VIP Customers

**Definition**: High-value customers driving significant revenue

**Qualification Criteria**:
- Lifetime Value > $2,000
- Purchase frequency: 4+ orders per year
- Average Order Value > $200
- Active within last 90 days
- Low return rate (< 10%)

**Characteristics**:
- Top 10% of customers by revenue
- Frequently purchase premium products
- High engagement with brand
- Brand advocates

**Marketing Actions**:
- Exclusive early access to new products
- Personalized recommendations
- Dedicated customer service line
- VIP events and trunk shows
- Special birthday offers (25% off vs. standard 15%)

---

### 2. Loyal Customers

**Definition**: Consistent, repeat buyers with moderate-to-high value

**Qualification Criteria**:
- Lifetime Value: $500-$2,000
- Purchase frequency: 2-3 orders per year
- Active within last 180 days
- Tenure: Customer for 12+ months

**Characteristics**:
- Reliable repeat business
- Moderate engagement
- Open to upsells and cross-sells
- Responds well to loyalty incentives

**Marketing Actions**:
- Loyalty program rewards
- Regular email newsletters
- Exclusive promotions (15% off)
- Product recommendations based on history
- Referral program incentives

---

### 3. At-Risk Customers

**Definition**: Previously active customers showing signs of churn

**Qualification Criteria**:
- No purchase in 180-365 days (used to be active)
- Previously had 2+ orders
- Decreasing order frequency over last year
- Low email engagement (open rate < 10%)

**Characteristics**:
- Declining engagement
- May be shopping with competitors
- Potentially dissatisfied or lost interest
- High value to retain (proven buyers)

**Marketing Actions**:
- Win-back campaigns ("We miss you!")
- Discount incentives (20% off)
- Survey to understand dissatisfaction
- Re-engage with new product launches
- Free shipping offers
- Personalized outreach from customer service

---

### 4. New Customers

**Definition**: Recently acquired customers in onboarding phase

**Qualification Criteria**:
- First purchase within last 90 days
- 1 order only
- Acquired via specific channel (paid ads, referral, organic)

**Characteristics**:
- Testing the brand
- Evaluating product quality and service
- Forming first impressions
- High potential for conversion to loyal

**Marketing Actions**:
- Welcome email series (3-5 emails over 30 days)
- First repeat purchase discount (15% off 2nd order)
- Product education content
- Request review/feedback
- Cross-sell complementary products
- Encourage loyalty program signup

---

### 5. Lapsed Customers

**Definition**: Inactive customers who haven't purchased recently

**Qualification Criteria**:
- No purchase in 365+ days
- Previously had 1+ orders
- Unresponsive to recent re-engagement campaigns
- Abandoned loyalty program (if enrolled)

**Characteristics**:
- Likely churned to competitors
- Low probability of return without strong incentive
- May have changed preferences or needs
- Potentially outdated contact information

**Marketing Actions**:
- Aggressive win-back offers (30% off, free gift)
- "We've changed!" messaging (highlight improvements)
- Re-permission email campaigns
- Surveys for feedback
- Suppression from regular campaigns (cost savings)
- Final "last chance" offer before archiving

---

### 6. One-Time Buyers

**Definition**: Customers with single purchase, not recent

**Qualification Criteria**:
- Exactly 1 order
- Purchase 90-365 days ago
- No repeat engagement
- Not classified as "New Customer" (outside 90-day window)

**Characteristics**:
- Never converted to repeat buyer
- May have been impulse purchase
- Possibly gift buyer (not end user)
- Needs incentive to return

**Marketing Actions**:
- Second purchase incentive (20% off)
- Product recommendations
- Highlight new arrivals
- Remind of brand value proposition
- Limited-time urgency campaigns

---

### 7. High-Potential Prospects

**Definition**: Customers showing buying signals but not yet converted to repeat

**Qualification Criteria**:
- 1 order in last 90 days
- High Average Order Value (> $150)
- Browsing behavior (if tracked via Shopify)
- Engaged with emails (open/click rates > 30%)

**Characteristics**:
- Interested in brand
- Potentially becoming loyal
- Responsive to marketing
- Worth investing in nurturing

**Marketing Actions**:
- Personalized product recommendations
- Loyalty program enrollment push
- Exclusive offers to encourage 2nd purchase
- VIP experience previews
- Early access to sales

---

## RFM Analysis Framework

**RFM** = Recency, Frequency, Monetary Value

### Recency (R)

**Definition**: How recently customer made a purchase

**Scoring** (1-5 scale, 5 = best):
- **5**: 0-30 days ago
- **4**: 31-90 days ago
- **3**: 91-180 days ago
- **2**: 181-365 days ago
- **1**: 365+ days ago

**Custom Field**: `custentity_rfm_recency_score` (Integer)

**Calculation**: Automated via scheduled workflow or script
- Formula: `DAYS_SINCE({last_order_date})`
- Update frequency: Daily

---

### Frequency (F)

**Definition**: How often customer makes purchases

**Scoring** (1-5 scale, 5 = best):
- **5**: 10+ orders
- **4**: 5-9 orders
- **3**: 3-4 orders
- **2**: 2 orders
- **1**: 1 order

**Custom Field**: `custentity_rfm_frequency_score` (Integer)

**Calculation**: Automated via saved search
- Formula: `COUNT({transaction})` where Transaction Type = Sales Order, Cash Sale

---

### Monetary Value (M)

**Definition**: How much customer has spent (lifetime value)

**Scoring** (1-5 scale, 5 = best):
- **5**: $2,000+
- **4**: $1,000-$1,999
- **3**: $500-$999
- **2**: $100-$499
- **1**: < $100

**Custom Field**: `custentity_rfm_monetary_score` (Integer)

**Calculation**: Automated via saved search
- Formula: `SUM({transaction.amount})` where Transaction Type = Sales Order, Cash Sale

---

### RFM Segment Mapping

**Combined RFM Score** → **Customer Segment**

| RFM Score | Segment | Description |
|-----------|---------|-------------|
| 555, 554, 545, 544 | VIP Champions | Best customers, highest value |
| 455, 454, 445, 444 | Loyal Customers | Consistent, reliable |
| 355, 354, 345, 344 | Potential Loyalists | Good customers, can grow |
| 535, 534, 525, 524 | Recent High-Spenders | New but high-value |
| 511, 512, 513, 514, 515 | New Customers | First-time buyers |
| 255, 254, 245, 244 | At-Risk Loyal | Good customers fading away |
| 155, 154, 145, 144 | At-Risk VIP | Best customers at risk of churn |
| 211, 212, 213, 214 | Lapsed Customers | Haven't purchased in long time |
| 111, 112, 121, 122 | Churned | Inactive, low value |

**Custom Field**: `custentity_rfm_segment` (List)
- Values: VIP Champions, Loyal, Potential Loyalists, At-Risk, New, Lapsed, Churned

---

## Automated Segment Assignment

### Workflow: Daily Segment Update

**Trigger**: Scheduled (daily at 2:00 AM)

**Process**:
1. **Calculate RFM Scores**:
   - Recency: Days since last order
   - Frequency: Total order count
   - Monetary: Total lifetime value

2. **Assign RFM Segment**:
   - Map combined RFM score to segment (see table above)
   - Update `custentity_rfm_segment` field

3. **Update Customer Category**:
   - Map RFM segment to customer category if needed
   - Example: VIP Champions → Customer Category = "VIP"

4. **Trigger Campaign Actions**:
   - If segment changes (e.g., Loyal → At-Risk), trigger re-engagement campaign
   - If New Customer, enroll in welcome series
   - If VIP, notify store managers

**Implementation**:
- **Option A**: Scheduled Workflow (native NetSuite)
- **Option B**: Scheduled SuiteScript (more flexibility)
- **Recommendation**: Option B for complex logic

---

### SuiteScript Pseudocode

```javascript
// Scheduled Script: Update Customer Segments
// Runs daily at 2 AM

function execute(context) {
  // Search all customers with transactions
  var customerSearch = search.create({
    type: search.Type.CUSTOMER,
    filters: [
      ['transaction.type', 'anyof', 'CustInvc', 'CashSale'], // Has orders
      'AND',
      ['isinactive', 'is', 'F'] // Active customers only
    ],
    columns: [
      search.createColumn({ name: 'internalid' }),
      search.createColumn({ name: 'datecreated', summary: 'MIN' }), // First order
      search.createColumn({ name: 'trandate', join: 'transaction', summary: 'MAX' }), // Last order
      search.createColumn({ name: 'internalid', join: 'transaction', summary: 'COUNT' }), // Order count
      search.createColumn({ name: 'amount', join: 'transaction', summary: 'SUM' }) // Total spend
    ]
  });

  customerSearch.run().each(function(result) {
    var customerId = result.getValue({ name: 'internalid' });
    var lastOrderDate = result.getValue({ name: 'trandate', join: 'transaction', summary: 'MAX' });
    var orderCount = result.getValue({ name: 'internalid', join: 'transaction', summary: 'COUNT' });
    var lifetimeValue = result.getValue({ name: 'amount', join: 'transaction', summary: 'SUM' });

    // Calculate RFM scores
    var recencyScore = calculateRecencyScore(lastOrderDate);
    var frequencyScore = calculateFrequencyScore(orderCount);
    var monetaryScore = calculateMonetaryScore(lifetimeValue);

    // Determine segment
    var segment = determineSegment(recencyScore, frequencyScore, monetaryScore);

    // Update customer record
    record.submitFields({
      type: record.Type.CUSTOMER,
      id: customerId,
      values: {
        'custentity_rfm_recency_score': recencyScore,
        'custentity_rfm_frequency_score': frequencyScore,
        'custentity_rfm_monetary_score': monetaryScore,
        'custentity_rfm_segment': segment,
        'custentity_segment_last_updated': new Date()
      }
    });

    return true; // Continue to next result
  });
}

function calculateRecencyScore(lastOrderDate) {
  var daysSince = Math.floor((new Date() - new Date(lastOrderDate)) / (1000 * 60 * 60 * 24));
  if (daysSince <= 30) return 5;
  if (daysSince <= 90) return 4;
  if (daysSince <= 180) return 3;
  if (daysSince <= 365) return 2;
  return 1;
}

function calculateFrequencyScore(orderCount) {
  if (orderCount >= 10) return 5;
  if (orderCount >= 5) return 4;
  if (orderCount >= 3) return 3;
  if (orderCount >= 2) return 2;
  return 1;
}

function calculateMonetaryScore(lifetimeValue) {
  if (lifetimeValue >= 2000) return 5;
  if (lifetimeValue >= 1000) return 4;
  if (lifetimeValue >= 500) return 3;
  if (lifetimeValue >= 100) return 2;
  return 1;
}

function determineSegment(r, f, m) {
  var score = r + '' + f + '' + m; // e.g., "555"

  // VIP Champions
  if (['555','554','545','544','455','454','445','444'].indexOf(score) > -1) {
    return 'VIP Champions';
  }

  // At-Risk
  if (['255','254','245','244','155','154','145','144'].indexOf(score) > -1) {
    return 'At-Risk';
  }

  // New Customers
  if (score.startsWith('5') && f == 1) {
    return 'New Customers';
  }

  // Lapsed
  if (r <= 2 && m >= 3) {
    return 'Lapsed';
  }

  // Default: Loyal
  return 'Loyal Customers';
}
```

---

## Segmentation Use Cases

### Use Case 1: VIP Event Invitation

**Objective**: Invite VIP customers to exclusive trunk show

**Segment**: VIP Champions (RFM 555, 554, 545, 544)

**Action**:
1. Saved search: Customers where `custentity_rfm_segment` = "VIP Champions"
2. Export email list
3. Create campaign in Klaviyo: "VIP Trunk Show Invitation"
4. Send personalized invitations
5. Track RSVP and attendance

**Expected Result**: 40% RSVP rate, $50K revenue from event

---

### Use Case 2: Win-Back Lapsed Customers

**Objective**: Re-engage customers who haven't purchased in 1+ year

**Segment**: Lapsed (RFM Recency = 1, previously had orders)

**Action**:
1. Saved search: Customers where `custentity_rfm_segment` = "Lapsed"
2. Create promotion: 30% off + free shipping (code: `COMEBACK30`)
3. Email campaign: "We Miss You! Here's 30% Off"
4. Track redemption rate
5. Move to "At-Risk" if they engage but don't purchase
6. Archive if no response after 90 days

**Expected Result**: 10% redemption rate, recover 50 customers

---

### Use Case 3: New Customer Onboarding

**Objective**: Convert first-time buyers to repeat customers

**Segment**: New Customers (1 order, < 90 days)

**Action**:
1. Automated workflow: When customer segment = "New Customers"
2. Trigger welcome email series:
   - Day 0: Thank you + product care tips
   - Day 7: Request review + 15% off 2nd order
   - Day 14: "Complete your look" cross-sell
   - Day 30: Loyalty program invitation
3. Track 2nd purchase rate
4. If 2nd purchase, move to "Loyal Customers"

**Expected Result**: 30% convert to 2nd purchase within 90 days

---

### Use Case 4: At-Risk Retention

**Objective**: Prevent churn of valuable customers

**Segment**: At-Risk (Previously Loyal/VIP, now Recency = 2 or 3)

**Action**:
1. Trigger alert: When segment changes from "Loyal" to "At-Risk"
2. Send personalized email: "We haven't seen you in a while!"
3. Offer: 20% off + early access to new arrivals
4. Customer service outreach: Call high-value at-risk customers
5. Survey: "Why haven't you shopped recently?"
6. Track response and purchases

**Expected Result**: Prevent 25% of at-risk from becoming lapsed

---

## Custom Segment Criteria (Beyond RFM)

### Behavioral Segments

**1. Style Preference Segments**
- Based on: `custentity_style_preference` field
- Segments: Classic Lovers, Sporty, Fashion-Forward, Minimalist
- Use: Product recommendations, targeted promotions

**2. Brand Affinity Segments**
- Based on: Purchase history of specific brands (Ray-Ban buyers, Oakley buyers, etc.)
- Use: New product launches, brand-specific promotions

**3. Channel Preference Segments**
- Based on: `custbody_sales_channel` on past orders
- Segments: Online Shoppers, In-Store Shoppers, Omnichannel
- Use: Channel-specific campaigns (online-only codes, in-store events)

**4. Price Sensitivity Segments**
- Based on: Purchase behavior (only buys on sale vs. full-price)
- Segments: Discount Seekers, Full-Price Buyers, Mixed
- Use: Promotion targeting (don't over-discount full-price buyers)

---

## Customer Lifecycle Segments

**Lifecycle Stages**:
1. **Prospect**: Email captured, no purchase yet (not in NetSuite, in Klaviyo/Shopify)
2. **First-Time Buyer**: 1 order, < 90 days
3. **Repeat Buyer**: 2-3 orders, < 1 year
4. **Loyal Customer**: 4+ orders, active
5. **VIP Customer**: High lifetime value, frequent
6. **At-Risk**: Was loyal, now fading
7. **Lapsed**: Inactive 1+ year
8. **Churned**: Inactive 2+ years, unresponsive

**Lifecycle Transitions**:
- Track when customers move between stages
- Trigger appropriate campaigns at each transition
- Goal: Move customers up the value ladder

---

## Segmentation Dashboards and Reports

### Segment Distribution Report

**Saved Search**: Customer Segmentation Summary

**Results**:
- Segment Name
- Customer Count
- % of Total Customers
- Total Lifetime Value
- Average Lifetime Value per Customer
- Total Orders
- Average Orders per Customer

**Chart**: Pie chart showing customer count by segment

---

### Segment Performance Report

**Saved Search**: Segment Revenue Contribution

**Results**:
- Segment Name
- Revenue This Month
- Revenue Last Month
- % Change
- Revenue YTD
- % of Total Revenue

**Chart**: Bar chart showing revenue by segment

---

### Segment Movement Report

**Saved Search**: Customers who changed segments this month

**Results**:
- Customer Name
- Previous Segment
- Current Segment
- Transition Date
- Last Order Date
- Lifetime Value

**Use**: Identify trends (e.g., many Loyal → At-Risk = problem)

---

## Integration with Campaign Management

**Link Segments to Campaigns**:

1. **Campaign Target Segment Field**: `custentity_campaign_target_segment` (from 070.010)
   - Maps campaign to specific segment(s)

2. **Campaign Creation**:
   - When creating campaign, select target segment(s)
   - Example: "VIP Event" campaign targets "VIP Champions" segment

3. **Performance Analysis**:
   - Compare campaign performance by segment
   - Identify which segments respond best to which campaign types

---

## Privacy and Compliance

### Data Usage
- Customer segmentation uses transactional data (purchases, order history)
- RFM analysis is based on aggregate behavior, not personal attributes
- Segments are for internal marketing use, not sold or shared

### Opt-Out
- Customers can opt-out of marketing emails (affects campaign reach, not segmentation)
- Segmentation continues for all customers (used for service quality, personalization)

### Data Retention
- Customer segments updated daily
- Historical segment data retained for trend analysis
- Archived customers (churned 2+ years) may be purged per data retention policy

---

## Testing Checklist

- [ ] RFM scores calculate correctly for sample customers
- [ ] Segment assignment matches expected logic
- [ ] Scheduled script runs daily without errors
- [ ] Saved searches return accurate segment lists
- [ ] Dashboard displays segment distribution
- [ ] Campaign targeting uses segments correctly
- [ ] Segment transitions trigger appropriate workflows
- [ ] Reports show segment performance metrics

---

## Implementation Plan

### Week 1: Build RFM Framework
- Create custom RFM fields on customer record
- Define RFM scoring logic
- Build segment mapping

### Week 2: Automation
- Develop scheduled SuiteScript for daily segment update
- Test segment assignment on sample data
- Validate accuracy

### Week 3: Reporting & Dashboards
- Create saved searches for segments
- Build segment distribution dashboard
- Create segment performance reports

### Week 4: Campaign Integration
- Link segments to campaign targeting
- Train marketing team on segment-based campaigns
- Test end-to-end workflow (segment → campaign → results)

---

## Success Metrics

- **Segment Coverage**: 100% of active customers assigned to segment
- **Segment Accuracy**: > 95% of customers in correct segment (validated by sampling)
- **Campaign Efficiency**: 20% improvement in campaign ROI using segmentation
- **Retention**: Reduce at-risk churn by 25%
- **Conversion**: Increase new-to-repeat rate by 15%

---

## Open Questions / Decisions Needed

1. **RFM Thresholds**: Confirm scoring thresholds (e.g., is $2K the right cutoff for VIP?)
2. **Update Frequency**: Daily segment updates sufficient, or real-time needed?
3. **Segment Granularity**: 8 segments enough, or need more detailed sub-segments?
4. **Lifecycle Tracking**: Track full lifecycle history (audit trail of segment changes)?
5. **Predictive Modeling**: Interest in ML-based churn prediction (beyond RFM)?

---

**Configuration Owner**: Marketing Team (CRM Manager)
**Technical Owner**: IT Team (SuiteScript development)
**Business Owner**: VP Digital Operations

**Status**: Ready for Implementation
**Last Updated**: 2026-02-04
